version: '3.8'

services:
  live-trading:
    build:
      context: .
      dockerfile: Dockerfile.live-trading
    image: graphwiz-live-trading:latest
    container_name: graphwiz-live-trading
    restart: unless-stopped

    environment:
      - TRADING_MODE=live
      - KRAKEN_API_KEY=${KRAKEN_API_KEY}
      - KRAKEN_API_SECRET=${KRAKEN_API_SECRET}
      - NEO4J_URI=${NEO4J_URI:-bolt://host.docker.internal:7687}
      - NEO4J_USERNAME=${NEO4J_USERNAME:-neo4j}
      - NEO4J_PASSWORD=${NEO4J_PASSWORD}
      - PYTHONUNBUFFERED=1

    volumes:
      - ./logs/live_trading:/app/logs/live_trading
      - ./config:/app/config:ro
      - ./data:/app/data

    ports:
      - "8080:8080"  # Health check endpoint
      - "9090:9090"  # Metrics endpoint

    networks:
      - trading-network

    healthcheck:
      test: ["CMD", "pgrep", "-f", "scripts/live_trade.py"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

networks:
  trading-network:
    driver: bridge
