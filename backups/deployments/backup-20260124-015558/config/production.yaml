# GraphWiz Trader Production Configuration
# This file contains production-ready settings for optimal performance and security

# Application metadata
version: "0.1.0"
environment: "production"
debug: false

# Logging configuration
logging:
  level: "INFO"  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "json"  # Options: json, text
  output:
    - type: "file"
      path: "/opt/git/graphwiz-trader/logs/graphwiz-trader.log"
      rotation: "10 MB"
      retention: "30 days"
      level: "INFO"
    - type: "file"
      path: "/opt/git/graphwiz-trader/logs/errors.log"
      rotation: "10 MB"
      retention: "90 days"
      level: "ERROR"
  console:
    enabled: false  # Disable console output in production
  structured: true
  include_timestamp: true
  include_hostname: true
  include_pid: true

# Neo4j Knowledge Graph Configuration
neo4j:
  uri: "${NEO4J_URI:-bolt://localhost:7687}"
  username: "${NEO4J_USERNAME:-neo4j}"
  password: "${NEO4J_PASSWORD:-graphwiz_secure_password}"
  database: "neo4j"
  max_connection_lifetime: 3600  # seconds
  max_connection_pool_size: 50
  connection_acquisition_timeout: 60  # seconds
  connection_timeout: 30  # seconds
  max_transaction_retry_time: 30  # seconds
  resolver:
    enabled: true
    max_tries: 3
    initial_retry_delay: 1000  # milliseconds
    multiplier: 2.0
    jitter_factor: 0.2
  indexes:
    auto_create: true
    background: true

# Trading Configuration
trading:
  mode: "${TRADING_MODE:-paper}"  # Options: paper, live, simulation
  max_position_size: 0.1  # 10% of portfolio
  max_daily_loss: 0.05  # 5% daily loss limit
  max_drawdown: 0.15  # 15% max drawdown
  commission_rate: 0.001  # 0.1% commission
  slippage_rate: 0.0005  # 0.05% slippage
  order_timeout: 30  # seconds
  enable_position_limits: true
  enable_risk_checks: true
  emergency_shutdown:
    enabled: true
    triggers:
      - type: "max_daily_loss"
        threshold: 0.05
      - type: "max_drawdown"
        threshold: 0.15
      - type: "system_error"
        consecutive_errors: 5

# Exchange Configuration
exchanges:
  binance:
    enabled: true
    api_key: "${BINANCE_API_KEY}"
    api_secret: "${BINANCE_API_SECRET}"
    testnet: false
    rate_limit: 1200  # requests per minute
    sandbox: false
    options:
      defaultType: "spot"
      adjustForTimeDifference: true
    markets:
      - "BTC/USDT"
      - "ETH/USDT"
      - "BNB/USDT"
    features:
      fetchOrderBook: true
      fetchTrades: true
      fetchTicker: true
      fetchBalance: true

  kraken:
    enabled: false
    api_key: "${KRAKEN_API_KEY}"
    api_secret: "${KRAKEN_API_SECRET}"
    rate_limit: 1200
    markets:
      - "BTC/USD"
      - "ETH/USD"

# AI/LLM Configuration
ai:
  provider: "${AI_PROVIDER:-openai}"  # Options: openai, anthropic
  model: "${AI_MODEL:-gpt-4}"
  temperature: 0.7
  max_tokens: 2000
  timeout: 30  # seconds
  max_retries: 3
  retry_delay: 1  # seconds
  cache_enabled: true
  cache_ttl: 3600  # seconds
  rate_limit:
    requests_per_minute: 60
    tokens_per_minute: 90000

  openai:
    api_key: "${OPENAI_API_KEY}"
    organization: "${OPENAI_ORG_ID:-}"
    base_url: "${OPENAI_BASE_URL:-https://api.openai.com/v1}"

  anthropic:
    api_key: "${ANTHROPIC_API_KEY}"
    base_url: "${ANTHROPIC_BASE_URL:-https://api.anthropic.com}"

# Agent Configuration
agents:
  enabled: true
  orchestrator:
    mode: "hierarchical"  # Options: flat, hierarchical
    max_parallel_agents: 5
    timeout: 300  # seconds
    retry_failed_tasks: true
    max_retries: 3

  trading_agent:
    model: "${AI_MODEL:-gpt-4}"
    temperature: 0.3  # Lower for trading decisions
    max_iterations: 10
    timeout: 120
    tools:
      - "analyze_market"
      - "calculate_indicators"
      - "evaluate_risk"
      - "generate_signals"

  research_agent:
    model: "${AI_MODEL:-gpt-4}"
    temperature: 0.7
    max_iterations: 15
    timeout: 180
    tools:
      - "search_knowledge_graph"
      - "analyze_patterns"
      - "backtest_strategy"

  risk_agent:
    model: "${AI_MODEL:-gpt-4}"
    temperature: 0.1  # Very low for risk assessment
    max_iterations: 5
    timeout: 60
    tools:
      - "calculate_var"
      - "assess_drawdown"
      - "check_limits"
      - "generate_alerts"

# Knowledge Graph Configuration
knowledge_graph:
  enabled: true
  auto_update: true
  update_interval: 3600  # seconds (1 hour)
  data_retention:
    market_data_days: 90
    trade_history_days: 365
    analysis_results_days: 180
  cache:
    enabled: true
    size_mb: 100
    ttl: 300  # seconds

# Optimization Configuration
optimizer:
  enabled: true
  mode: "bayesian"  # Options: grid, random, bayesian, genetic
  max_iterations: 100
  parallel_jobs: 4
  timeout: 600  # seconds
  objectives:
    - name: "sharpe_ratio"
      weight: 0.4
      direction: "maximize"
    - name: "max_drawdown"
      weight: 0.3
      direction: "minimize"
    - name: "profit_factor"
      weight: 0.3
      direction: "maximize"

# Backtesting Configuration
backtesting:
  engine: "vectorized"  # Options: simple, vectorized
  initial_capital: 100000
  commission: 0.001
  slippage: 0.0005
  data:
    source: "graph"
    preload: true
    cache: true
  reports:
    save_to_db: true
    generate_plots: false  # Disable in production (no display)
    output_format: "json"  # Options: json, html

# Monitoring and Alerting
monitoring:
  enabled: true
  metrics:
    enabled: true
    port: 9090
    path: "/metrics"
    collect_interval: 15  # seconds
    labels:
      service: "graphwiz-trader"
      environment: "production"

  health:
    enabled: true
    port: 8080
    path: "/health"
    checks:
      - name: "neo4j_connection"
        interval: 30  # seconds
        timeout: 5
      - name: "trading_engine"
        interval: 10
        timeout: 5
      - name: "memory_usage"
        interval: 60
        threshold_percent: 90
      - name: "disk_space"
        interval: 300
        threshold_percent: 85

  alerts:
    enabled: true
    channels:
      - type: "log"
        level: "WARNING"
      - type: "webhook"
        url: "${ALERT_WEBHOOK_URL:-}"
        enabled: false
    rules:
      - name: "high_error_rate"
        condition: "error_rate > 10"
        duration: 300  # seconds
      - name: "memory_high"
        condition: "memory_usage > 90"
        duration: 120
      - name: "trading_losses"
        condition: "daily_pnl < -5000"
        duration: 60

# Risk Management
risk:
  enabled: true
  max_position_size: 10000  # USDT
  max_portfolio_exposure: 0.5  # 50% of total capital
  max_correlation_exposure: 0.3  # 30% in correlated assets
  stop_loss:
    enabled: true
    default_percent: 0.02  # 2%
    trailing_percent: 0.01  # 1%
  take_profit:
    enabled: true
    default_percent: 0.05  # 5%
    partial_targets:
      - percent: 0.5  # Take 50% profit at 3%
        target: 0.03
      - percent: 1.0  # Take remaining at 5%
        target: 0.05

# Performance Tuning
performance:
  thread_pool_size: 8
  async_io: true
  connection_pooling: true
  query_cache_size: 1000
  enable_profiling: false
  optimization_level: "O2"

# Security Configuration
security:
  enable_auth: true
  jwt_secret: "${JWT_SECRET}"
  jwt_expiry: 3600  # seconds (1 hour)
  api_key_required: true
  rate_limiting:
    enabled: true
    requests_per_minute: 60
    burst: 10
  ip_whitelist: []
  encryption:
    enabled: true
    algorithm: "AES-256-GCM"
    key_path: "/opt/git/graphwiz-trader/config/encryption.key"

# Web Interface (if enabled)
web:
  enabled: true
  host: "0.0.0.0"
  port: 8080
  workers: 4
  access_log: "/opt/git/graphwiz-trader/logs/access.log"
  error_log: "/opt/git/graphwiz-trader/logs/error.log"
  cors:
    enabled: false  # Disable in production
    origins: []
  csrf:
    enabled: true
  ssl:
    enabled: false  # Let Nginx handle SSL
    cert_path: ""
    key_path: ""

# Data Configuration
data:
  base_path: "/opt/git/graphwiz-trader/data"
  cache_path: "/tmp/graphwiz_cache"
  log_path: "/opt/git/graphwiz-trader/logs"
  backup:
    enabled: true
    interval: 86400  # seconds (24 hours)
    retention_days: 30
    path: "/opt/git/graphwiz-trader/backups/data"

# Development/Debug Settings (disable in production)
development:
  debug_mode: false
  profiling: false
  query_logging: false
  slow_query_threshold: 1000  # milliseconds
  mock_mode: false
